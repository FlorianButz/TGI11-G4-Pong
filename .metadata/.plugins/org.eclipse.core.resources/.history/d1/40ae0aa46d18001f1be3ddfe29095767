package de.demoncore.sprites;

import java.awt.AlphaComposite;
import java.awt.Graphics2D;
import java.awt.Transparency;
import java.awt.image.BufferedImage;
import java.awt.image.VolatileImage;
import java.io.File;
import java.io.IOException;

import javax.imageio.ImageIO;

import de.demoncore.gui.Gui;

public class Sprite {
	
	private String filepath;
	private VolatileImage texture;
	
	public Sprite(String filepath) {
		this.filepath = filepath;
	}
	
	public Sprite Load() {

		if(texture != null){
            texture.flush();
            texture = null;
        }
		
		try {
		
			BufferedImage bufferedImage = ImageIO.read(de.demoncore.main.Main.class.getResourceAsStream(filepath));
			
			VolatileImage vImage = Gui.GetGraphicsConfig().createCompatibleVolatileImage(bufferedImage.getWidth(), bufferedImage.getHeight(), Transparency.TRANSLUCENT);

	        do {
	            if (vImage.validate(Gui.GetGraphicsConfig()) == VolatileImage.IMAGE_INCOMPATIBLE) {
	                vImage = Gui.GetGraphicsConfig().createCompatibleVolatileImage(bufferedImage.getWidth(), bufferedImage.getHeight(), Transparency.TRANSLUCENT);
	            }

	            Graphics2D g = vImage.createGraphics();
	            g.setComposite(AlphaComposite.Src);
	            g.drawImage(bufferedImage, 0, 0, null);
	            g.dispose();
	        } while (vImage.contentsLost());
			
	        texture = vImage;
	        
		}catch(IOException e) {
			System.err.println("Konnte Bilddatei nicht laden. " + e.getLocalizedMessage() + " : " + filepath);
		}
		
		return this;
	}
	
	public VolatileImage GetTexture() {
		return texture;
	}
}
